version: "3.9"

services:
  envoy:
    build:
      context: ../../../.. # backend root directory
      dockerfile: internal/test/integration/xds/envoy.Dockerfile
    volumes:
    - ../../../..:/code
    - ~/.cache/go-build:/root/.cache/go-build
    - ~/go:/go
    ports:
      - "10000:10000"
      - "9901:9901"
  test_runner:
    image: golang:1.16.0
    volumes:
    - ../../../..:/code
    - ~/.cache/go-build:/root/.cache/go-build
    - ~/go:/go
    command: sh -c 'cd /code/module/chaos/serverexperimentation/xds && go test -tags integration_only'
    ports:
      - "9000:9000"
